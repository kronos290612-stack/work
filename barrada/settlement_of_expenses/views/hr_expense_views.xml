<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="view_expense_sheet_form_inherit_settlement" model="ir.ui.view">
        <field name="name">hr.expense.sheet.form.inherit.settlement</field>
        <field name="model">hr.expense.sheet</field>
       <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form"/>
        <field name="arch" type="xml">
            <field name="employee_journal_id" position="after">
                <field name="liquidation_status" invisible="is_liquidation == False"/>
            </field>

            <!-- Agregar pestaña de solicitud después de la pestaña "Expenses" -->
            <page name="expenses" position="after">
                <page name="trip_request" string="Request for Expenses and Travel">
                    <group>
                        <group string="Destination" name="destination_group" col="4">
                            <field name="destination" colspan="4"/>
                        </group>
                        <group string="Reasons" name="jestination_group" col="4">
                            <field name="justification" colspan="4"/>
                        </group>

                    </group>

                    <separator string="Trip Details"/>

                    <group>
                        <group string="Expenses" name="expenses_group" col="2">
                            <field name="overnight"/>
                            <field name="date_since"
                                   invisible="overnight != True" />
                            <field name="date_up"
                                   invisible="overnight != True"/>
                            <field name="number_days"
                                   invisible="overnight != True"/>
                        </group>

                        <group string="Tickets" name="tickets_group" col="2">
                            <field name="type_ticket"/>
                            <field name="flight_date"
                                   invisible="type_ticket != 'air'"/>
                            <field name="airline"
                                   invisible="type_ticket != 'air'" />
                            <field name="route"
                                   invisible="type_ticket != 'air'"/>
                            <field name="flight"
                                   invisible="type_ticket != 'air'"/>
                        </group>

                    </group>

                </page>
            </page>

            <!-- Agregar información de liquidación en el header -->
            <xpath expr="//field[@name='state']" position="after">
                <field name="liquidation_status"
                       widget="badge"
                       invisible="state == 'draft'"
                       decoration-success="liquidation_status == 'liquidated'"
                       decoration-warning="liquidation_status == 'pending'"/>
               <field name="is_liquidation" invisible="1"/>
               <field name="original_sheet_id" invisible="1"/>
                <field name="settlement_sheet_id" invisible="1"/>
            </xpath>
           
            <!-- Botón Liquidar Anticipo (solo en estado 'done' y no es liquidación) -->
            <xpath expr="//header/button[@name='action_register_payment']" position="after">
                <button name="action_settle_advance"
                        string="Settle Advance"
                        type="object"
                        class="btn-primary"
                        invisible="state != 'done',is_liquidation == 'False' "
                        groups="hr_expense.group_hr_expense_manager"/>
            </xpath>


            <!--Adicionar en las Lineas las Columnas-->
            <xpath expr="//field[@name='expense_line_ids']/list/field[@name='name']" position="after">
                <field name="real_expenses" widget="monetary" column_invisible="parent.is_liquidation == False"/>
                <field name="total_expenses_verified" column_invisible="parent.is_liquidation == False"/>
                <field name="verified" column_invisible="parent.is_liquidation == False"/>
                <field name="supporting_documents" column_invisible="parent.is_liquidation == False"/>
                <field name="refund" column_invisible="parent.is_liquidation == False"/>
            </xpath>

        </field>
    </record>

    <!-- Vista de lista para resaltar liquidaciones -->
     <record id="view_expense_sheet_tree_inherit_liquidation" model="ir.ui.view">
        <field name="name">hr.expense.sheet.tree.inherit.liquidation</field>
        <field name="model">hr.expense.sheet</field>
        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='total_amount']" position="after">
                <field name="is_liquidation" invisible="1"/>
                <field name="liquidation_status" invisible="1"/>
            </xpath>
            <xpath expr="//list" position="attributes">
                <attribute name="decoration-danger">is_liquidation == True</attribute>
            </xpath>
        </field>
    </record>
</odoo>
