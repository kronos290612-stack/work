<?xml version="1.0" encoding="utf-8"?>
<odoo>

<!--    view_hr_expense_sheet_tree-->
    <record id="view_account_area_expense_sheet_sheet_tree" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.list</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <list string="Expense Reports" multi_edit="1" js_class="hr_expense_tree" sample="1" decoration-info="state == 'draft'">
                    <field name="product_ids" column_invisible="True"/>
                    <field name="currency_id" column_invisible="True"/>
                    <field name="company_currency_id" column_invisible="True"/>
                    <field name="is_editable" column_invisible="True"/>
                    <field name="accounting_date" optional="hide" groups="account.group_account_manager" readonly="not is_editable"/>
                    <field name="create_date" optional="hide"/>
                    <field name="name" string="Nombre Reporte" readonly="not is_editable"/>
                    <field name="area_manager_id" />
                    <field name="provider_id" />
                    <field name="approved_id" />
                    <field name="area_payment_mode" optional="hide"/>
                    <field name="user_id" optional="hide" widget="many2one_avatar_user" readonly="state != 'draft'"/>
                    <field name="company_id" optional="show" groups="base.group_multi_company" readonly="state != 'draft'"/>
                    <field name="activity_ids" widget="list_activity" optional="show" readonly="True"/>
                    <field name="journal_id" optional="hide" readonly="not is_editable"/>
                    <field name="total_amount" sum="Total Amount" decoration-bf="1" widget="monetary"/>
                    <field name="state" optional="show"
                           decoration-info="state == 'draft'"
                           decoration-success="state in ['approve', 'post', 'done']"
                           decoration-warning="state == 'submit'"
                           decoration-danger="state == 'cancel'"
                           widget="badge"/>
                    <field name="payment_state" optional="show"
                           decoration-info="payment_state in ('partial','in_payment')"
                           decoration-success="payment_state == 'paid'"
                           decoration-danger="payment_state in ('reversed','not_paid')"
                           widget="badge" invisible="state in ['draft', 'submit', 'cancel']"/>
                </list>
            </field>
        </record>

        <!-- List view for "My Reports" with header -->
<!--        view_hr_expense_sheet_dashboard_tree_header-->
        <record id="view_account_area_expense_sheet_dashboard_tree_header" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.dashboard.list</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="priority">20</field>
            <field name="inherit_id" ref="view_account_area_expense_sheet_sheet_tree"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <xpath expr="//list" position="attributes">
                    <attribute name="js_class">hr_expense_dashboard_tree</attribute>
                </xpath>
            </field>
        </record>

<!--        view_hr_expense_sheet_kanban-->
        <record id="view_account_area_expense_sheet_kanban" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.kanban</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <kanban class="o_kanban_mobile" sample="1">
                    <field name="currency_id"/>
                    <templates>
                        <t t-name="card">
                            <div class="d-flex">
                                <field class="fw-bold fs-5" name="name"/>
                                <field class="fw-bold ms-auto" name="total_amount" widget="monetary"/>
                            </div>
                            <div class="d-flex text-muted mt8">
                                <field class="ms-auto" name="state" widget="label_selection"
                                       options="{'classes': {'draft': 'default', 'submit': 'default',
                                                             'cancel': 'danger', 'post': 'warning',
                                                             'done': 'success'}}"/>
                            </div>
                            <field class="mt8 text-muted" name="accounting_date"/>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Kanban view without header -->
<!--    view_hr_expense_sheet_kanban_no_header-->
        <record id="view_account_area_expense_sheet_sheet_kanban_no_header" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.kanban</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_kanban"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <xpath expr="//kanban" position="attributes">
                    <attribute name="js_class">hr_expense_kanban</attribute>
                </xpath>
            </field>
        </record>

        <!-- Kanban view with header -->
<!--    view_hr_expense_sheet_kanban_header-->
        <record id="view_account_area_expense_sheet_kanban_header" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.kanban</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="inherit_id" ref="view_account_area_expense_sheet_kanban"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <xpath expr="//kanban" position="attributes">
                    <attribute name="js_class">hr_expense_dashboard_kanban</attribute>
                </xpath>
            </field>
        </record>

<!--        view_hr_expense_sheet_pivot-->
        <record id="view_account_area_expense_sheet_pivot" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.pivot</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <pivot string="Expenses Analysis" sample="1">
                    <field name="accounting_date" interval="month" type="col"/>
                    <field name="total_amount" type="measure"/>
                </pivot>
            </field>
        </record>

<!--        view_hr_expense_sheet_graph-->
        <record id="view_account_area_expense_sheet_graph" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.graph</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <graph string="Expenses Analysis" sample="1">
                    <field name="accounting_date" interval="month"/>
                    <field name="total_amount" type="measure"/>
                </graph>
            </field>
        </record>

<!--        hr_expense_sheet_view_search-->
        <record id="account_area_expense_sheet_view_search" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.view.search</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <search string="Expense">
                    <field string="Expense Report" name="name"/>
                    <field name="accounting_date"/>
                    <separator />
                    <field string="Encargado de Ã¡rea" name="area_manager_id" />
                    <field string="Proveedor" name="provider_id" />
                    <field string="Journal" name="journal_id"/>
                    <separator invisible="1"/>
                    <separator />
                    <filter string="Date" name="filter_accounting_date" date="accounting_date"/>
                    <separator/>
                    <filter invisible="1" string="Late Activities" name="activities_overdue"
                        domain="[('my_activity_date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"
                        help="Show all records which has next action date is before today"/>
                    <filter invisible="1" string="Today Activities" name="activities_today"
                        domain="[('my_activity_date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>
                    <filter invisible="1" string="Future Activities" name="activities_upcoming_all"
                            domain="[('my_activity_date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))
                            ]"/>
                    <group expand="0" string="Group By" name="group_filters">
                        <filter string="Department" name="department" domain="[]" context="{'group_by': 'department_id'}"/>
                        <filter string="Company" name="company" domain="[]" context="{'group_by': 'company_id'}"
                                groups="base.group_multi_company"/>
                        <filter string="Date" name="expenses_month" domain="[]" context="{'group_by': 'accounting_date'}"
                                help="Expenses by Date"/>
                        <filter string="Status" domain="[]" context="{'group_by': 'state'}" name="state"/>
                    </group>
                </search>
            </field>
        </record>

<!--    hr_expense_sheet_view_search_with_panel-->
        <record id="account_area_expense_sheet_view_search_with_panel" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.view.search.with.panel</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="inherit_id" ref="account_area_expense_sheet_view_search"/>
            <field name="mode">primary</field>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='group_filters']" position='after'>
                    <searchpanel>
                        <field name="state" expand="1" select="multi" icon="fa-check-square-o" enable_counters="1"/>
                        <field name="area_manager_id" expand="1" select="multi" icon="fa-check-square-o" enable_counters="1"/>
                        <field name="employee_id"  limit="20" hierarchize="0" select="one" icon="fa-users"/>
                        <field name="company_id" expand="1" icon="fa-building" groups="base.group_multi_company"/>
                    </searchpanel>
                </xpath>
            </field>
        </record>

<!--    hr_expense_sheet_view_activity-->
        <record id="account_area_expense_sheet_view_activity" model="ir.ui.view">
            <field name="name">account.area.expense.sheet.activity</field>
            <field name="model">account.area.expense.sheet</field>
            <field name="arch" type="xml">
                <activity string="Expenses">
                    <field name="employee_id"/>
                    <field name="currency_id"/>
                    <templates>
                        <div t-name="activity-box">
                            <img class="rounded"
                                 t-att-src="activity_image('hr.employee', 'avatar_128', record.employee_id.raw_value)"
                                 t-att-title="record.employee_id.value" t-att-alt="record.employee_id.value"/>
                            <div class="ms-2">
                                <field name="name" display="full" class="o_text_block"/>
                                <field name="total_amount" widget="monetary" muted="1" display="full"/>
                                <field name="state" display="right"/>
                            </div>
                        </div>
                    </templates>
                </activity>
            </field>
        </record>

<!--        action_hr_expense_sheet_my_all-->
        <record id="action_account_area_expense_sheet_my_all" model="ir.actions.act_window">
            <field name="name">My Reports</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="path">my-expense-reports-area</field>
            <field name="view_mode">list,kanban,form,pivot,graph,activity</field>
            <field name="search_view_id" ref="account_area_expense_sheet_view_search"/>
            <field name="context">{'search_default_my_reports': 1, 'search_default_not_refused_reports': 1}</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                No expense report found. Let's create one!
              </p><p>
                Once you have created your expense, submit it to your manager who will validate it.
              </p>
            </field>
        </record>

        <!-- List & Kanban view for "My Reports" with header -->
        <record id="action_hr_expense_sheet_my_all_tree" model="ir.actions.act_window.view">
            <field name="view_mode">list</field>
            <field name="view_id" ref="view_account_area_expense_sheet_dashboard_tree_header"/>
            <field name="act_window_id" ref="action_account_area_expense_sheet_my_all"/>
        </record>

        <record id="action_hr_expense_sheet_my_all_kanban" model="ir.actions.act_window.view">
            <field name="view_mode">kanban</field>
            <field name="view_id" ref="view_account_area_expense_sheet_kanban_header"/>
            <field name="act_window_id" ref="action_account_area_expense_sheet_my_all"/>
        </record>

<!--    action_hr_expense_sheet_all-->
        <record id="action_account_area_expense_sheet_all" model="ir.actions.act_window">
            <field name="name">All Reports</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="path">expense-reports-all-area</field>
            <field name="view_mode">list,kanban,form,pivot,graph</field>
            <field name="search_view_id" ref="account_area_expense_sheet_view_search_with_panel"/>
            <field name="domain">[]</field>
            <field name="view_id" ref="view_account_area_expense_sheet_sheet_tree"/>
            <field name="context">{ 'searchpanel_default_state': ["draft", "submit", "approve", "post", "done"] }</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No expense reports found. Let's create one!
                </p><p>
                    Expense reports regroup all the expenses incurred during a specific event.
                </p>
            </field>
        </record>

<!--    action_hr_expense_account-->
        <record id="action_account_area_expense_sheet_account" model="ir.actions.act_window">
            <field name="name">Employee Expenses</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="view_mode">list,kanban,form,pivot,graph</field>
            <field name="search_view_id" ref="account_area_expense_sheet_view_search"/>
            <field name="view_id" ref="view_account_area_expense_sheet_sheet_tree"/>
            <field name="domain">[]</field>
            <field name="context">{
                'search_default_approved': 1,
                'search_default_to_post': 1,
            }
            </field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Create a new expense report
              </p><p>
                Once you have created your expense, submit it to your manager who will validate it.
              </p>
            </field>
        </record>

<!--    action_hr_expense_sheet_all_all-->
        <record id="action_account_area_expense_sheet_all_all" model="ir.actions.act_window">
            <field name="name">All Expense Reports</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="view_mode">graph,pivot,list,kanban,form</field>
            <field name="search_view_id" ref="account_area_expense_sheet_view_search"/>
            <field name="domain">[]</field>
            <field name="help" type="html">
              <p class="o_view_nocontent_smiling_face">
                Create a new expense report
              </p><p>
                Once you have created your expense, submit it to your manager who will validate it.
              </p>
            </field>
        </record>

<!--    action_hr_expense_sheet_department_to_approve-->
        <record id="action_account_area_expense_sheet_department_to_approve" model="ir.actions.act_window">
            <field name="name">Expense Reports to Approve</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="view_mode">list,kanban,form,pivot,graph</field>
            <field name="search_view_id" ref="account_area_expense_sheet_view_search_with_panel"/>
            <field name="context">{ 'searchpanel_default_state': ["submit"] }</field>
            <field name="domain">[('department_id', '=', active_id)]</field>
        </record>

<!--    action_hr_expense_sheet_department_filtered-->
        <record id="action_account_area_expense_sheet_department_filtered" model="ir.actions.act_window">
            <field name="name">Expense Reports Analysis</field>
            <field name="res_model">account.area.expense.sheet</field>
            <field name="view_mode">graph,pivot</field>
            <field name="context">{
                'search_default_department_id': [active_id],
                'default_department_id': active_id}
            </field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    No data yet!
                </p>
            </field>
        </record>


<!--    <record id="view_account_area_expense_sheet_tree_header" model="ir.ui.view">-->
<!--        <field name="name">account.area.expense.sheet.list</field>-->
<!--        <field name="model">account.area.expense.sheet</field>-->
<!--        <field name="priority">20</field>-->
<!--        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_dashboard_tree_header"/>-->
<!--        <field name="mode">primary</field>-->
<!--        <field name="arch" type="xml">-->
<!--            <field name="employee_id" position="replace">-->
<!--            </field>-->
<!--        </field>-->
<!--    </record>-->

    <record id="view_account_area_expense_sheet_form" model="ir.ui.view">
        <field name="name">account.area.expense.sheet.view.form</field>
        <field name="model">account.area.expense.sheet</field>
        <field name="inherit_id" ref="hr_expense.view_hr_expense_sheet_form"/>
        <field eval="35" name="priority"/>
        <field name="mode">primary</field>
        <field name="arch" type="xml">

            <button name="action_sheet_move_post" position="replace">
                <button name="action_sheet_move_post"
                            string="Registrar asientos contables"
                            type="object"
                            data-hotkey="y"
                            class="oe_highlight o_expense_sheet_post"
                            invisible="state != 'approve'"
                            context="{'account_area_expense_sheet': True}"
                            groups="account.group_account_invoice"/>
            </button>

            <button name="action_sheet_move_post" position="replace">
                <button name="action_sheet_move_post"
                            string="Registrar asientos contables"
                            type="object"
                            data-hotkey="y"
                            class="oe_highlight o_expense_sheet_post"
                            invisible="state != 'approve'"
                            context="{'account_area_expense_sheet': True}"
                            groups="account.group_account_invoice"/>
            </button>

            <button name="action_open_account_moves" position="replace">
                <button name="action_open_account_moves"
                        class="oe_stat_button"
                        icon="fa-bars"
                        type="object"
                        context="{'account_area_expense_sheet': True}"
                        invisible="state not in ['approve', 'post', 'done'] or nb_account_move == 0"
                        groups="account.group_account_invoice">
                        <div class="o_stat_info">
                            <field name="nb_account_move" class="o_stat_value"/>
                            <span class="o_stat_text">Journal Entry</span>
                        </div>
                    </button>
            </button>

            <button name="action_register_payment" position="replace">
                <button name="action_register_payment"
                            string="Pay"
                            type="object"
                            data-hotkey="w"
                            class="oe_highlight o_expense_sheet_pay"
                            context="{'dont_redirect_to_payments': True, 'account_area_expense_sheet': True}"
                            invisible="payment_mode == 'company_account' or state not in ('post', 'done') or payment_state in ('paid', 'in_payment')"
                            groups="account.group_account_invoice"/>
            </button>

            <xpath expr="//group[@name='employee_details']" position="replace">
                <group>
                    <field name="area_manager_id" />
                    <field name="provider_id" required="True"/>
                    <field name="approved_id" />
                    <field name="employee_journal_id"
                                   groups="account.group_account_invoice,account.group_account_readonly"
                                   options="{'no_open': True, 'no_create': True}"
                                   readonly="not is_editable"
                                   context="{'default_company_id': company_id}"/>
                </group>
            </xpath>

            <xpath expr="//sheet/notebook/page[@name='expenses']/field[@name='expense_line_ids']" position="replace">
                 <field name="account_expense_line_ids"
                        nolabel="1"
                        widget="expense_lines_widget"
                        mode="list,kanban"
                        domain="[
                            ('account_sheet_id', '=', False),
                            ('employee_id', '=', employee_id),
                            ('company_id', '=', company_id),
                            ('payment_mode', '=?', payment_mode),
                        ]"
                        options="{'reload_on_button': True}"
                        context="{
                            'form_view_ref' : 'account_area_expense.account_area_expense_view_form_without_header',
                            'kanban_view_ref' : 'hr_expense.hr_expense_kanban_view_minimal',
                            'default_company_id': company_id,
                            'default_employee_id': employee_id,
                            'default_payment_mode': payment_mode or 'own_account',
                            'check_total_amount_not_zero': True,
                        }"
                        readonly="not is_editable"
                        force_save="1">
                    <list editable="bottom">
                        <field name="employee_id" column_invisible="True"/>
                        <field name="state" column_invisible="True"/>
                        <field name="nb_attachment" column_invisible="True"/>
                        <field name="message_main_attachment_checksum" column_invisible="True"/>
                        <field name="message_main_attachment_id" column_invisible="True"/>
                        <field name="company_id" column_invisible="True"/>
                        <field name="company_currency_id" column_invisible="True"/>
                        <field name="is_multiple_currency" column_invisible="True"/>
                        <field name="product_has_cost" column_invisible="True"/>
                        <field name="date" optional="show"/>
                        <field name="product_id" required="1"/>
                        <field name="name"/>
                        <field name="description" optional="hide"/>
                        <field name="vendor_id" optional="hide" column_invisible="payment_account_mode != 'company'" required="payment_account_mode == 'company'"/>
                        <button name="action_get_attachment_view" type="object" icon="fa-paperclip"
                                aria-label="View Attachments" title="View Attachments" class="float-end pe-0"
                                readonly="True" invisible="nb_attachment == 0"/>
                        <field name="analytic_distribution" widget="analytic_distribution"
                               groups="analytic.group_analytic_accounting"
                               optional="show"
                               options="{'product_field': 'product_id', 'account_field': 'account_id', 'business_domain': 'expense'}"/>
                        <field name="account_id" optional="hide" groups="account.group_account_readonly"/>
                        <field name="price_unit" optional="hide" widget="monetary" options="{'currency_field': 'company_currency_id', 'field_digits': True}" readonly="True"/>
                        <field name="currency_id" optional="hide" readonly="True" groups="base.group_multi_currency"/>
                        <field name="quantity" optional="hide" readonly="True"/>
                        <field name="tax_ids" string="Taxes" optional="show" widget="many2many_tags"
                               context="{'default_company_id': company_id}" readonly="True"/>
                        <field name="tax_amount_currency" optional="hide"  options="{'currency_field': 'currency_id'}"
                               context="{'default_company_id': company_id}" readonly="True" groups="base.group_multi_currency"/>
                        <field name="tax_amount" optional="hide" readonly="True"/>
                        <field name="total_amount_currency" options="{'currency_field': 'currency_id'}"
                               string="Subtotal In Currency " optional="show"
                               readonly="true" groups="base.group_multi_currency"/>
                        <field name="total_amount" string="Subtotal" readonly="True"/>
                    </list>
                </field>
            </xpath>

        </field>
    </record>


</odoo>